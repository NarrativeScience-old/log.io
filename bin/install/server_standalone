#! /bin/sh
#
# Log.io server install script (run as user that will own the process)
#
# ARGUMENTS (in that order $1, $2, ...)
# LOG_PATH (defaults to /var/log/log.io)

NODE_MODULES_PATH=`dirname \`which node\``/../lib/node_modules
BIN_PATH=`dirname \`which node\``/..

LOG_PATH=$1
[ "$LOG_PATH" = "" ] &&  LOG_PATH=/var/log/log.io

echo "Copying source to $NODE_MODULES_PATH/log.io/";
mkdir -p $NODE_MODULES_PATH/log.io
cp -r `dirname $0`/../../lib/server/ $NODE_MODULES_PATH/log.io/
cp -r `dirname $0`/../../lib/client/ $NODE_MODULES_PATH/log.io/
echo "... done."

echo "Copying bin/run_server to $BIN_PATH";
cp `dirname $0`/../run_server $BIN_PATH/log-server
echo "... done."

# Create log file
if [ ! -f $LOG_PATH/server.log ] ; then
  echo "Creating $LOG_PATH/server.log";
  mkdir -p $LOG_PATH/
  touch $LOG_PATH/server.log
  chmod 755 $LOG_PATH/server.log
	echo "... done."
else
	echo "Log file $LOG_PATH/server.log already exists";
fi
